<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Avans Opdracht</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <h1>Individuele Eindopracht D3</h1>

    <svg id="shapes" width="800" height="250">
        <rect x="62" y="47" fill="#01A0B0" width="156" height="156"/>
        <circle fill="#CC333F" cx="410" cy="125" r="78"/>
        <polygon fill="#EDC950" points="589,203 679,47 770,203 "/>
    </svg>

    <h2><em>Maak drie prototypes waarin je telkens een andere visualisatievorm kiest, met minimaal twee filtermogelijkheden.</em></h2>

    <h2 class="italic">Bijvoorbeeld</h2>

    <h2>Aantal winkels per provincie in 2012 <small>Bron: <a href="http://www.hbd.nl/pages/15/Winkels/Dierenspeciaalzaken/Aantal-winkels-per-provincie.html?subonderwerp_id=233">HBD o.b.v. CBS en Locatus</a></small></h2>

    <h3>Vorm: staafdiagram met drie datasets</h3>

    <button id="animalshops">Toon Dierenwinkels</button>
    <button id="jewelshops">Toon Juweliers</button>
    <button id="bikeshops">Toon Fietsenwinkels</button>

    <div id="shops" class="barchart"></div>

    <script src="../d3-examples/lib/d3.js"></script>
    <script>
        var counter = 0;

        var shapes = {
            rect : d3.select('#shapes rect'),
            circle : d3.select('#shapes circle'),
            polygon : d3.select('#shapes polygon')
        };

        var csv = d3.dsv(';');

        function createScale(data, maxWidth) {
            return d3.scale.linear()
                .domain([0, 520])
                .range([0, maxWidth])
        }

        function shapesIn() {
            shapes.rect.transition().duration(500).attr('width', 50);
            shapes.circle.transition().duration(500).attr('fill', '#FF8000');
            shapes.polygon.transition().duration(500).attr('transform', 'rotate(60, 689, 80)');
        }

        function shapesOut() {
            shapes.rect.transition().duration(500).attr('width', 156);
            shapes.circle.transition().duration(500).attr('fill', '#cc333f');
            shapes.polygon.transition().duration(500).attr('transform', 'rotate(0, 689, 80)');
        }

        function redrawShops(data) {
            var values = data.map(function(d) {
                return parseInt(d.value);
            });

            var scale = createScale(
                values,
                parseInt(d3.select('#shops').style('width'))
            );

            d3.select('#shops').selectAll('div')
                .data(data)
                .transition()
                .duration(1000)
                .style('width', function(d) {
                    return scale(d.value) + 'px';
                })
                .text(function(d) {
                    return d.key + ' (' + d.value + ')';
                })
        }

        function drawShops(data) {
            var values = data.map(function(d) {
                return parseInt(d.value);
            });

            var scale = createScale(
                values,
                parseInt(d3.select('#shops').style('width'))
            );

            d3.select('#shops').selectAll('div')
                .data(data)
                .enter()
                .append('div')
                .style('width', function(d) {
                    return scale(d.value) + 'px';
                })
                .text(function(d) {
                    return d.key + ' (' + d.value + ')';
                })
        }

        function animate() {
            if (counter % 2 === 0) {
                shapesIn();
            } else {
                shapesOut();
            }

            counter++;
            setTimeout(animate, 2000);
        }

        function loadBarChart(csvfile, drawType) {
            csv(csvfile, function(err, data) {
                data = d3.entries(data[0]);

                if (drawType === 'draw') {
                    drawShops(data);
                } else {
                    redrawShops(data);
                }
            });
        }


        d3.select('#animalshops').on('click', function() {
            loadBarChart('animalShops.csv', 'redraw');
        });

        d3.select('#jewelshops').on('click', function() {
            loadBarChart('jewelShops.csv', 'redraw');
        });

        d3.selectAll('#bikeshops').on('click', function() {
            loadBarChart('bikeShops.csv', 'redraw');
        });

        animate();
        loadBarChart('animalShops.csv', 'draw');
    </script>
</body>
</html>